!function(t){function e(t,e){t+=/\?/g.test(t)?"&":"?";for(var i in e)t=t+encodeURIComponent(i)+"="+encodeURIComponent(e[i]);return t}function i(t){return s||(s=this.init(t))}function r(t){t.src="about:blank",t.parentNode&&t.parentNode.removeChild(t),t.onload=null}function n(t,e){return t=parseInt(t,10),e=parseInt(e,10),0==t&&0==e?m["char"]:1==t&&1==e?m.click:1==t&&4==e?m.piece:1==t&&7==e?m.coordinate_big:1==t&&8==e?m.slide:1==t&&9==e?m.slidePuzzle:(w.btn_width=m["default"].btn_width,w)}var s,o={preTrigerPoint:"preTrigerPoint",securityCode:"securityCode"},h=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,!1)[e]},c=function(t){return function(e){return Object.prototype.toString.call(e)=="[object "+t+"]"}},a=c("Object"),d=c("Function"),u=function(t,e){if(t&&e){if(a(e)){for(var i in e)t.style[i]=e[i];return e}return h(t,e)}},p=function(t){if("undefined"!=typeof t.offsetParent){for(var e=0,i=0;t;t=t.offsetParent)e+=t.offsetLeft,i+=t.offsetTop;return[e,i]}return[t.x,t.y]},g=function(t){var e=u(t,"width"),i=u(t,"height");return[parseInt(e,10),parseInt(i,10)]},l=function(t,e,i){i=i||!1;var r={};for(var n in e)t[n]=e[n];if(i){for(var n in t)r[n]=t[n];return r}return t},f=function(t){var i=window.document.getElementsByTagName("script")[0],r=window.document.createElement("script"),n=t.callback||"callback",s="_aq_"+Math.floor(1e6*Math.random()),o=window[s]=t.success||function(){},h=t.url,c={};c[n]=s,t.data&&(c=l(c,t.data)),h=e(h,c),r.async=t.async||!0,r.src=h,r.onload=function(){r&&i.parentNode&&i.parentNode.removeChild(r),o=null},i.parentNode.insertBefore(r,i)},m={"char":{btn_width:298,height:160,width:300},click:{btn_width:326,height:483,width:328},coordinate:{btn_width:282,width:284,height:273},coordinate_big:{btn_width:298,width:300,height:277},piece:{height:516,btn_width:362,width:366},slide:{height:260,width:300,btn_width:298},slidePuzzle:{height:232,width:300,btn_width:298},"default":{btn_width:350}},y={minHeight:40,minWidth:230},w={height:300,width:400},b={type:"point",ele:document.body,src:"",startFn:function(){},endFn:function(){}};i.prototype={init:function(t){return this.opts=l(b,t),this.initOptions(),this.listenFunc=[],this.msg=new Messenger("parent"),this.initListener(),this.create(),this},initOptions:function(){this.ele=this.opts.ele,this.src=this.opts.src,this.ticket="",this.randstr="",this.sizeSC=l({},w),this.securityIframe=""},create:function(){var t=this;switch(this.opts.type){case"point":this.createPreTrigerPoint();break;case"embed":f({url:t.opts.s_type,success:function(i){var r=n(i.captype,i.subcaptype),s=t.opts.domain+"/"+i.src+t.opts.s_type_suffix;s=e(s,{noBorder:"noborder"}),t.createSecurityCode(s,r,t.opts.ele)}});break;case"popup":f({url:t.opts.s_type,success:function(i){var r=n(i.captype,i.subcaptype),s=t.opts.domain+"/"+i.src+t.opts.s_type_suffix;s=e(s,{showtype:"popup"}),t.createSecurityCode(s,{width:r.width,height:r.height+40},document.body)}})}},createPreTrigerPoint:function(){this.wrap="",this.preTrigerPoint&&this.nullIframe(!0);var t=document.createElement("div");t.style.position="relative";var i=document.createElement("iframe");i.setAttribute("frameborder","0",0),i.setAttribute("border","0"),i.marginheight=0,i.marginwidth=0,i.setAttribute("marginheight","0",0),i.setAttribute("marginwidth","0",0),i.scrolling="no";var r=h(this.ele,"width"),n=h(this.ele,"height");r&&"auto"!=r?parseInt(r,10)<y.minWidth?this.clientW=y.minWidth+"px":this.clientW=r:this.clientW="100%",!n||"auto"==n||parseInt(n,10)<y.minHeight?this.clientH=y.minHeight+"px":this.clientH=n;var s={width:this.clientW,height:this.clientH,border:"none",position:"relative",minHeight:y.minHeight+"px",minWidth:y.minWidth+"px",zIndex:10};u(i,s),this.src&&(this.opts.themeColor&&(this.src=e(this.src,{color:this.opts.themeColor})),i.src=this.src),this.preTrigerPoint=i,this.wrap=t,this.wrap.appendChild(this.preTrigerPoint),this.ele.appendChild(this.wrap),this.initPreTriggerPointTarget()},initListener:function(){var t=this;this.listenResize(),this.msg.listen(function(e){try{var i=JSON.parse(e)}catch(r){throw new Error('The data needs to be like "JSON.stringify({message: xxx})"!')}i=i.message;var s=i.type;switch(s){case 0:return void t.collapsePreTriggerPoint();case 1:return void(i.size&&t.setSCheight(parseInt(i.size.height,10)));case 2:return void t.send2preTriggerPoint();case 3:if(t.opts.startFn(),i&&i.ticket){t.ticket=i.ticket,t.randstr=i.randstr;for(var o=0,h=t.listenFunc.length;o<h;o++)t.closeSecurityCode(function(){t.listenFunc[o]({ret:0,ticket:i.ticket,randstr:i.randstr})});t.listenFunc.length||t.closeSecurityCode();var c=parseInt(t.clientW,10)>y.minWidth?parseInt(t.clientW,10):y.minWidth;t.send2preTriggerPoint(JSON.stringify({message:{width:c-2,type:"reduce"}}))}else{if(i&&i.src){var a=n(i.captype,i.subcaptype);t.createSecurityCode(i.src,a,document.body),u(t.preTrigerPoint,{width:a.btn_width+2+"px"}),t.send2preTriggerPoint(JSON.stringify({message:{width:a.btn_width,type:"expand"}}))}t.securityIframe&&t.setPosition(t.securityIframe)}return;case 4:return void t.send2securityCode(JSON.stringify({message:{type:i.task}}));case 5:return void t.send2preTriggerPoint(JSON.stringify({message:{type:i.task}}));case 6:return void t.closeSecurityCode();case 7:u(t.preTrigerPoint,{width:i.size.btn_width+2+"px"});var d={height:i.size.height+"px",width:i.size.width+"px"};return u(t.securityIframe,d),void t.setPosition(t.securityIframe)}})},initPreTriggerPointTarget:function(){this.msg.addTarget(this.preTrigerPoint.contentWindow,o.preTrigerPoint)},createSecurityCode:function(t,i,r){this.sizeSC.height=i&&i.height?i.height:this.sizeSC.height,this.sizeSC.width=i&&i.width?i.width:this.sizeSC.width;var n=this;if(this.opts.themeColor&&(t=e(t,{color:this.opts.themeColor})),this.opts.type&&(t=e(t,{showtype:this.opts.type})),t=e(t,{rnd:Math.floor(1e6*Math.random())}),this.hasSecurityCode()){this.securityIframe.src=t;var s={height:this.sizeSC.height+"px",width:this.sizeSC.width+"px"};return u(this.securityIframe,s),void this.setPosition(n.securityIframe)}var o=document.createElement("iframe");o.setAttribute("frameborder","0",0),o.setAttribute("border","0"),o.marginheight=0,o.marginwidth=0,o.setAttribute("marginheight","0",0),o.setAttribute("marginwidth","0",0);var s={width:this.sizeSC.width+"px",height:this.sizeSC.height+"px",border:"0px",position:"embed"==this.opts.type?"relative":"absolute",left:"0px",top:"0px",zIndex:1e4};u(o,s),this.securityIframe=o,r.appendChild(o),o.src=t,this.setPosition(o),this.initSecurityCodeTarget()},hasSecurityCode:function(){var t=!!this.securityIframe&&this.securityIframe;return t},initSecurityCodeTarget:function(){this.msg.addTarget(this.securityIframe.contentWindow,o.securityCode)},destroy:function(){this.closeSecurityCode(),this.listenFunc=[],this.msg.clear(),this.ele.innerHTML="",security=""},refresh:function(){this.closeSecurityCode(),this.ele.innerHTML="",this.initOptions(),this.create()},setSrc:function(t){this.tpl.src=t},listen:function(t){this.listenFunc.push(t)},clear:function(){this.listenFunc.length=0},send2preTriggerPoint:function(t){if("point"==this.opts.type){var e=o.preTrigerPoint;this.msg.targets[e].send(t)}},send2securityCode:function(t){var e=o.securityCode;this.msg.targets[e].send(t)},setSCheight:function(t){u(this.securityIframe,{height:t+"px"}),this.sizeSC.height=t,this.setPosition(this.securityIframe)},getPTPpos:function(){return p(this.preTrigerPoint)},getSCsize:function(){return[this.sizeSC.width,this.sizeSC.height]},getPTPsize:function(){return g(this.preTrigerPoint)},setPosition:function(t){if("embed"!=this.opts.type){var e=0,i=0;if("popup"==this.opts.type){var r=this.getSCsize(),n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e=(s-r[1])/2,i=(n-r[0])/2}if("point"==this.opts.type){var o=this.getPTPpos(),h=this.getPTPsize();e=o[1]+h[1],i=o[0]}return u(t,{top:e+"px",left:i+"px"})}},closeSecurityCode:function(t){this.opts.endFn(),this.securityIframe&&this.nullIframe(),d(t)&&t(),window.CollectGarbage&&window.CollectGarbage()},listenResize:function(){var t=this;window.onresize=function(){t.securityIframe&&t.setPosition(t.securityIframe)}},getTicket:function(){return{ticket:this.ticket,randstr:this.randstr}},collapsePreTriggerPoint:function(){u(this.preTrigerPoint,{width:this.clientW})},start:function(t){this.opts.startFn=t},end:function(t){this.opts.endFn=t},nullIframe:function(t){return t?(r(this.preTrigerPoint),void(this.preTrigerPoint=null)):(r(this.securityIframe),void(this.securityIframe=null))}},t.AqSCode=i}(window);